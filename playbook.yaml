- name: Synchronize reednet computers
  hosts: reednet
  tasks:
    - name: Ensure SSH accepts env vars
      become: true
      ansible.builtin.copy:
        content: |
          AcceptEnv COLORTERM
          AcceptEnv DARKMODE
        dest: '/etc/ssh/sshd_config.d/10-sam-accept-env.conf'
        group: 'root'
        mode: '644'
        owner: 'root'

    - name: Set system flake registry
      become: true
      ansible.builtin.copy:
        src: './registry.json'
        dest: '/etc/nix/registry.json'
        owner: 'root'
        group: 'root'
        mode: '644'

    - name: Install Patty's TLS cert.
      become: true
      ansible.builtin.copy:
        src: './certs/patty.reed.edu.pem'
        dest: '/usr/local/share/ca-certificates/patty.reed.edu.crt'
        group: 'root'
        owner: 'root'
        mode: '644'

    - name: Update CA certs.
      become: true
      ansible.builtin.command: 'update-ca-certificates'

    # Synchronize globally installed packages
    - import_tasks: packages.yaml

    # Synchronize users
    - import_tasks: users.yaml

        

    # falcon
    # nix
    # tailscale
    # motd
    # /etc/hosts
